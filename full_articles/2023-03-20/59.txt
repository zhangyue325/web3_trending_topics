3 月 16 日，据以太坊核心开发者 Tim Beiko 的推文，以太坊基金会核心开发团队已经确认上海升级将于网路区块高度 6209536 时进行，具体为 UTC 时间 4 月 12 日晚上 22:27:35。

上海升级临近，在网上各篇文章中，出现了 Shapella、ShanghaiUpgrade、上海 Shapella 升级、Sepolia 的 Shapella 升级等词，对于不太关注的人来说可能已经绕晕了。那么这些表述是否正确？上海升级不是 Shanghai Upgrade 吗？

我们将围绕这些问题对以太坊上海升级进行深入的了解。

![](https://img.foresightnews.pro/202303/929f7db7988d81ac7ad6c9d23366a9fa.jpg?x-oss-process=style/scale70)

一、以太坊升级
-------

2020 年 12 月，以太坊引入了 Beacon 链，也称信标链，代表着以太坊将由 PoW 向 PoS 转变。

在此之前，以太坊执行层和共识层由一条链负责，现在，执行层和共识层由两条平行的链分开负责。共识层由 Beacon 链负责，执行层由曾经的以太坊主网负责。

但 Beacon 存在一个问题，用户可以通过智能合约从执行层向共识层存入 ETH，却无法从共识层向执行层取出 ETH。随着时间推移，Beacon 链上积累了很多 ETH，至今仍无法被取出。数据显示，Beacon 链上 ETH 已超过 1770 万枚，占总供应量的 14.75 %，换算后市值接近 300 亿美元。因此 Beacon 链的 ETH 提款功能必须被实现。

然而，在以太坊最终于 2022 年 9 月合并（将主网与 Beacon 链合并）时，质押的 ETH 并未被释放，以太坊基金会明确表示，只有在上海升级后才能提款（质押的 ETH 释放），因此，ETH 释放成为上海升级最大的看点。

![](https://img.foresightnews.pro/202303/82657c06fe92a003e8322e1c2be7708a.png?x-oss-process=style/scale70)

### （1）上海升级

以太坊执行层升级以城市命名。上海升级是以太坊执行层的下一次硬分叉，此前已经经历了君士坦丁堡升级、伊斯坦布尔升级、柏林升级、伦敦升级、巴黎升级。

每次升级都意味着以太坊有了一些重大的更新，比如伦敦升级后 EIP-1559 改变了矿工的收入结构，巴黎升级后改变了以太坊的运行机制等等。

而此次上海升级，将解决以太坊合并后留下的 ETH 质押问题。上海升级一共将部署 5 个 EIP：

① EIP-3651: Warm COINBASE，降低以太坊网络费用（降低访问 COINBASE 地址的 gas 开销）

② EIP-3855: PUSH0 instruction，减少的是交易规模（新增操作码 PUSH0）

③ EIP-3860: Limit and meter initcode，修复拒绝服务攻击向量和限制 gas 费用（对 initcode 的大小设限并引入 gas 计量）

④ EIP-4895: Beacon chain push withdrawals as operations，允许验证者提取质押的 ETH（信标链推式提款作为系统操作）

⑤EIP-6049: Deprecate SELFDESTRUCT，以太坊开发者交易费用的可能上限和积极影响（取消 SELFDESTRUCT）

此外，为了顺利推进上海升级，一些实现 EVM 对象格式（EOF）的 EIP 已被放在下一次坎昆升级进行。

### （2）Capella 升级

以太坊共识层升级以星星命名。Capella 升级是以太坊共识层的下一次硬分叉，此前经历了 Phase0 升级、Altair 升级、Bellatrix 升级。

本次 Capella 升级有 3 个主要内容：

① 提款验证器自动提款。第一点功能只是促进了验证器集中的某个验证器的完全退出或全额提款。当轮到他们提款时，可将他们的全部余额提取到提款地址。

② 带 0x01 提款凭证及余额超过 MAX\_EFFECTIVE\_BALANCE 值的验证器的部分提款遍历。第二点功能允许验证器自动将超过最低限制 32 ETH 以外的 ETH 提取到上述相同的提款地址。

③从 BLS\_ WITHDRAWAL\_ PREFIX 更新为 ETH1\_ ADDRESS\_ WITHDRAWAL\_ PREFIX 版本的提款凭证，以启用验证器提款。就第三点功能而言，如果验证者在存款时没有设置提款地址，现在可以设置一个地址，以便他们可以使用部分和全额提款功能。

### （3）Shapella 升级

Shapella 并不是一个单词，而是 Shanghai-Capella 的合成词。因为共识层已与主网合并，开发者便把两者合称为 Shapella 升级。

有意思的是，以太坊基金会并没有官方声明将此次升级改名为 Shapella，但随着时间的推移，核心开发人员开始将两个重大升级合称为 Shapella。

所以，本次上海升级更准确应该称为“Shapella 升级”，因为它同时在执行层和共识层完成升级。标志着以太坊向权益证明（PoS）网络的全面过渡的完成，并将最终实现质押的 ETH 提款。

二、测试网提前部署 Shapella 升级
---------------------

第 156 次以太坊执行层核心开发者会议（ACDE）于北京时间 3 月 2 日 22:00 举行，此次会议的议题包括：总结 Shapella 升级在 Sepolia 测试网上的情况、为 Goerli 测试网的 Shapella 升级设定时间、讨论下一次升级的范围，以及在客户端弃用一些非共识功能。

### （1）Sepolia 测试网的 Shapella 升级

Sepolia 测试网的 Shapella 升级在分叉期间发送了几个 BLS 凭证更新，处理起来都没有问题。由于在 Sepolia 上的验证者集是非常小的，只有一笔完整提款得到了测试。Nethermind 发现了有少量坏块，但与上海升级的代码无关。开发者还发现了 MetaMask 上的漏洞——提款账户的余额更新不准确，但问题似乎已解决了，可能由缓存问题导致。

### （2）Goerli 测试网的 Shapella 升级

客户端团队认为可以推进 Goerli 测试网的 Shapella 升级，在北京时间 3 月 14 日 18:25 进行 Goerli 测试网的 Shapella 升级。如果在 Goerli 上的升级进行顺利，他们将会在 3 月 16 日的 ACDE 上确定主网 Shapella 升级的日期。

三、Shapella 带来的影响
----------------

Shapella 升级主要确保验证者质押提款，这其实是主网上已经可用的功能。当以太坊于 2022 年 9 月合并时，提款功能被禁用，这是为确保安全过渡而采取的措施。一旦以太坊 Shapella 更新完成，验证者将能够通过 EIP-4895 从 Beacon 链中提取质押的 ETH。

此外，本次升级 EIP-3651、EIP-3855、EIP-3860、EIP-6049 等改进将降低网络用户、优化某些活动的 gas 成本。随着以太坊网络的快速发展，此类增强功能将使网络及其用户受益匪浅。

### （1）对质押者的影响

验证者仍然需要质押 32 ETH 才能获得网络验证权，但 Shapella 升级推出后，他们更有动力参与。

### （2）对 ETH 的影响

目前，ETH 处于通货紧缩状态，一旦 Shapella 升级形成，这种情况可能会改变。虽然 ETH 生态系统的波动性较大，无法预测对价格的影响，但之前的例子表明，以太坊的每一次重大升级都会推高价格。

### （3）对其他加密资产的影响

以太坊目前拥有近 19% 的市场支配地位，如果遇到一些抛售压力，可能会导致整个市场波动。然而，从中长期来看，围绕上海硬分叉的资金不足立场和利益相关者情绪可能不会对市场产生如此严重的影响。

### （4）对购买者的影响

以太坊仍然是最受欢迎的加密资产之一。上海硬分叉之后，由于近期的一些卖压，价格可能会暂时下跌，为机构提供了一个入场点。

### （5）对 DeFi 的影响

质押提款肯定会促使人们寻找流动性质押衍生品并将其再投资。这对于更广泛的 DeFi 前景来说可能是个好消息。

### （6）对 ETH 2.0 的意义

Vitalik Buterin 曾表示以太坊在合并后仅完成了 55%。然而，随着以太坊上海升级，生态系统可能会得到重大推动，迅速走向终结。随着股权开放和生态系统获得更多流动性，ETH 2.0 可能比以往任何时候都更接近。

![](https://img.foresightnews.pro/202303/f69a368e5a071b2683c52bfb3c9d6813.jpg?x-oss-process=style/scale70)

结语
--

虽然尚不清楚即将到来的 Shapella 升级在短期内对以太坊价格的影响，以及提款流程一旦可用将如何运作，但 Shapella 升级是以太坊 PoS 网络全面功能的又一大步，受到加密世界的高度期待。

未来，开发人员将致力于实现以太坊分片，以及其他可扩展网络的升级。在这个近十年之久的项目中，如果没有贡献者的努力付出，我们在 DeFi 和更广泛的以太坊生态中所体验的一切都是不可能的。

接下来，就让我们一起享受上海升级，并期待着下一次的坎昆升级！

参考：

Shiqi《从 0 到 1：了解以太坊上海升级》

BanklessDAO：《详述以太坊 Shapella 升级》

《什么是以太坊上海升级？》

编辑：Bowenn@Web3CN.Pro

声明：web3 中文编辑作品，内容仅代表作者立场，且不构成投资建议，请谨慎对待，如文章 / 素材有侵权，请联系官方客服处理。

